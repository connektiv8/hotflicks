# docker/core/service-registry/conf/server.conf

# This file is managed by Terraform. Do not edit this file manually.

# Consul configuration file
# https://www.consul.io/docs/agent/options.html

# Basic server configuration
datacenter = "hotflicks-dc1"
node_name = "consul-server"
server = true
bootstrap_expect = 3
retry_join = ["consul-server-1", "consul-server-2", "consul-server-3"]

# Performance tuning
performance {
  raft_multiplier = 1
  leave_on_terminate = true
  reconnect_timeout = "72h"
}

# Access Control Lists
acl {
  enabled = true
  default_policy = "deny"
  enable_token_persistence = true
  tokens {
    master = "REPLACED_BY_VAULT"
    agent = "REPLACED_BY_VAULT"
  }
}

# TLS Configuration
tls {
  defaults {
    verify_incoming = true
    verify_outgoing = true
    ca_file = "/etc/consul/tls/ca.pem"
    cert_file = "/etc/consul/tls/server.pem"
    key_file = "/etc/consul/tls/server-key.pem"
  }
  internal_rpc {
    verify_server_hostname = true
  }
}

# Telemetry configuration for monitoring
telemetry {
  prometheus_retention_time = "24h"
  disable_hostname = true
  enable_hostname_label = true
}

# Log configuration
log_level = "INFO"
log_json = true